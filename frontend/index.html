<!DOCTYPE html>
<html>

<head>
    <!-- Standard Meta -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="/assets/images/favicon.png" />

    <!-- Site Properities -->
    <meta name="generator" content="DocPad v6.79.4" />
    <title>Green Metrics Tool - Experimental 0.1</title>

    <meta name="description" content="Using Fomantic UI with Other Libraries" />
    <meta name="keywords" content="html5, ui, library, framework, javascript, fork, official" />

    <script src="./assets/js/jquery.min.js"></script>
    <script src="./assets/js/tablesort.min.js"></script>
    <script src="./assets/js/search.min.js"></script>
    <script src="./assets/js/easing.min.js"></script>
    <script src="./assets/js/semantic.min.js"></script>
    <script src="./assets/js/stats.js"></script>

    <link rel="stylesheet" type="text/css" class="ui" href="./dist/semantic.min.css">
    <link rel="stylesheet" type="text/css" href="./assets/css/green-coding.css">
    <link rel="stylesheet" href="./assets/vendors/css/jquery.toast.min.css">
</head>

<body style="display: flex;">


    <div id="menu" class="ui inverted vertical menu">
        <div>
            <img class="ui fluid image" src="./assets/images/logo.png">
        </div>
        <div class="item">
            <p>Demo user</p>
        </div>
        <a class="item" href="/index.html">
            <b><i class="home icon"></i>Home</b>
        </a>
        <a class="item" href="/request.html">
            <b><i class="bullseye icon"></i>Certify new software</b>
        </a>
        <a class="item" href="/data-analysis.html">
            <b><i class="chart line icon"></i>Data Analysis</b>
        </a>
        <a class="item" href="/showcases.html">
            <b><i class="glasses icon"></i>Showcases</b>
        </a>

    </div> <!-- end menu -->



                    <div class="main ui container" id="main">

                        <div class="ui steps horizontal" id="header">
                        <a href="#" id="menu-toggle" class="opened"><i class="arrow circle left icon openend"></i></a>

                          <div class="step">

                            <div class="content">
                              <div class="title"><h2>Green Metrics Tool Dashboard</h2></div>
                              <div class="description">View the energy and CO2 consumption of your measured software</div>
                            </div>
                          </div>
                        </div>

                        <div class="ui search right">
                            <div class="ui icon input">
                                <input class="prompt" type="text" placeholder="Search tests...">
                                <i class="search icon"></i>
                            </div>
                            <div class="results"></div>
                        </div>

                        <table class="ui sortable celled striped table" id="table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>URI</th>
                                    <th>Last Crawl</th>
                                    <th>
                                        <button onclick="compareButton()">
                                            Compare
                                        </button>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="projects-table">
                        </table>
                    </div>
                </div>
            </div>
        </div>

    <script>
        var chart_cpu = null;
        var chart_energy = null;
        var chart_mem = null;
        var chart_net_in = null;
        let content = [];
        try {
            if (document.location.host.indexOf('metrics.green-coding.org') === 0)
                api_url = "https://api.green-coding.org";
            else
                api_url = "http://api.green-coding.local:8000";

            fetch(api_url + '/v1/projects')
                .then(response => response.json())
                .then(my_json => {
                    if (my_json.success != true) {
                        alert(my_json.err);
                        return;
                    }

                    my_json.data.forEach(el => {
                        const li_node = document.createElement("tr");
                        const link_node = document.createElement('a');
                        content.push({ title: el[1] });
                        link_node.innerText = el[1];
                        link_node.title = el[1];
                        link_node.href = "/stats.html?id=" + el[0];
                        li_node.appendChild(link_node);
                        li_node.innerHTML = '<td class="td-index">' + li_node.innerHTML + '</td><td class="td-index">' + el[2] + '</td><td class="td-index">' + el[3] + '</td><td><input type="checkbox" value="' + el[0] + '" name="chbx-proj" />&nbsp;</td>';

                        document.getElementById("projects-table").appendChild(li_node);
                    })
                    $('.ui.search').search({ source: content });
                })
        } catch (e) {
            alert("Fetch failed: " + e)
        }

        function compareButton() {
            var checkedBoxes = document.querySelectorAll('input[name=chbx-proj]:checked');
            console.log(checkedBoxes.length);
            var link = "";
            if (checkedBoxes.length == 2) {
                link = "/multi.html?dummy=dummy";
            }
            else if (checkedBoxes.length > 2) {
                link = "/compare.html?dummy=dummy";
            }
            else {
                alert("Please select at least two projects to compare :-)");
                return;
            }

            checkedBoxes.forEach(checkbox => {
                link += "&pid[]=" + checkbox.value;
            });
            //console.log(link);
            window.location = link;
        }
        $(document).ready(function () {
            $('table').tablesort();
        });

    </script>

</body>

</html>